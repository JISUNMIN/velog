ê¸°ì¡´ì—ëŠ” Taskì˜ ìƒíƒœë¥¼ ë³€ê²½í•˜ê¸° ìœ„í•´ ë‹¨ìˆœíˆ **status í•„ë“œë§Œ ì—…ë°ì´íŠ¸**í–ˆìŠµë‹ˆë‹¤.  
ì´ ë°©ì‹ì€ Kanban ë³´ë“œì—ì„œ **ìˆœì„œ(order)ê°€ ë°”ë€Œì—ˆì„ ë•Œ ì´ë¥¼ ë°˜ì˜í•˜ì§€ ëª»í•˜ëŠ” ë¬¸ì œ**ê°€ ìˆì—ˆìŠµë‹ˆë‹¤.

í”„ë¡ íŠ¸ì—”ë“œ(Local)ì—ì„œëŠ” Zustandë¡œ ìˆœì„œë¥¼ ë³´ì¥í•˜ê³  ìˆì—ˆì§€ë§Œ,  
APIëŠ” statusë§Œ ë°”ê¿”ì£¼ë‹¤ ë³´ë‹ˆ **í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ ìƒíƒœê°€ ë™ê¸°í™”ë˜ì§€ ì•Šì•„ ìˆœì„œê°€ ê¹¨ì§€ëŠ” ë¬¸ì œ**ê°€ ìƒê²¼ìŠµë‹ˆë‹¤.

ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ `/move` APIë¥¼ ìƒˆë¡œ ë§Œë“¤ê³ ,  
**Prisma íŠ¸ëœì­ì…˜ì„ í™œìš©í•´ì„œ ìˆœì„œ ì¬ì •ë ¬ê¹Œì§€ ë°˜ì˜ë˜ë„ë¡ ìˆ˜ì •**í–ˆìŠµë‹ˆë‹¤.

---

## ğŸ’¡ ì™œ APIë¥¼ ìˆ˜ì •í–ˆëŠ”ê°€?

### â— ë¬¸ì œì 
- ê¸°ì¡´ APIëŠ” **statusë§Œ ë³€ê²½**í•˜ê³  orderëŠ” ê°±ì‹ í•˜ì§€ ì•Šì•„, ì»¬ëŸ¼ ê°„ ì´ë™ ì‹œ ìˆœì„œê°€ ê¼¬ì´ëŠ” ë¬¸ì œê°€ ìˆì—ˆìŠµë‹ˆë‹¤.
- **ë¡œì»¬ ìƒíƒœ(Zustand)ì—ì„œëŠ” ë¬¸ì œê°€ ì—†ì—ˆì§€ë§Œ**, API í˜¸ì¶œ í›„ ë°ì´í„°ë¥¼ refetchí•˜ë©´
  - ì„œë²„ì—ì„œ ì˜ëª»ëœ order ê°’ìœ¼ë¡œ ë‚´ë ¤ì˜¤ê¸° ë•Œë¬¸ì—
  - í”„ë¡ íŠ¸ì—”ë“œ ìƒíƒœê°€ ë‹¤ì‹œ ê°±ì‹ ë  ë•Œ **ìˆœì„œê°€ ë’¤ì„ì´ëŠ” í˜„ìƒ**ì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤.

###  ğŸ¯ ëª©í‘œ
- **ì»¬ëŸ¼ ì´ë™ ì‹œ status ë³€ê²½ê³¼ ë™ì‹œì— orderë¥¼ ì¬ì •ë ¬**í•˜ë„ë¡ APIë¥¼ ê°œì„ í–ˆìŠµë‹ˆë‹¤.
- ì—¬ëŸ¬ update ì¿¼ë¦¬ë¥¼ **Prisma íŠ¸ëœì­ì…˜ìœ¼ë¡œ ë¬¶ì–´ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬**í–ˆìŠµë‹ˆë‹¤.

## ğŸ”„ ë³€ê²½ ì „ ì½”ë“œ

```ts
// app/api/tasks/[taskId]/status/route.ts
const updatedTask = await prisma.task.update({
  where: { id: Number(taskId) },
  data: { status },
});
```

## ğŸ”„ ë³€ê²½ëœ ì½”ë“œ (Prisma $transaction ì‚¬ìš©)
```ts
// app/api/tasks/[taskId]/move/route.ts
const task = await prisma.task.findUnique({ where: { id } });
const targetTasks = await prisma.task.findMany({
  where: { status: toColumn, projectId },
  orderBy: { order: "asc" },
});

const filteredTasks = targetTasks.filter((t) => t.id !== id);
filteredTasks.splice(toIndex, 0, task);

await prisma.$transaction([
  prisma.task.update({
    where: { id },
    data: { status: toColumn },
  }),
  ...filteredTasks.map((t, index) =>
    prisma.task.update({
      where: { id: t.id },
      data: { order: index },
    })
  ),
]);

```

## âš™ï¸ Prisma íŠ¸ëœì­ì…˜ì´ë€?

`prisma.$transaction()`ì€ ì—¬ëŸ¬ DB ì¿¼ë¦¬ë¥¼ í•˜ë‚˜ì˜ ì‘ì—…ìœ¼ë¡œ ë¬¶ì–´ ì‹¤í–‰í•˜ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤.

- **ì›ìì„±(Atomicity)**: ì¤‘ê°„ì— í•œ ì¿¼ë¦¬ë¼ë„ ì‹¤íŒ¨í•˜ë©´ ëª¨ë“  ì¿¼ë¦¬ê°€ ë¡¤ë°±ë©ë‹ˆë‹¤.
- **ì •í•©ì„±(Consistency)**: ì¿¼ë¦¬ê°€ ì¼ë¶€ë§Œ ì ìš©ë˜ëŠ” ìƒí™©ì„ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ APIì—ì„œëŠ” ë‹¤ìŒ ë‘ ì‘ì—…ì„ í•œ ë²ˆì— ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.

1. ì´ë™í•œ Taskì˜ status ë³€ê²½  
2. í•´ë‹¹ ì»¬ëŸ¼ì˜ ëª¨ë“  Task order ì¬ì •ë ¬

### Prisma íŠ¸ëœì­ì…˜ ì‚¬ìš©ë²•

```ts
await prisma.$transaction([
  prisma.model.update({ where: { id: 1 }, data: { field: 'value' } }),
  prisma.model.create({ data: { ... } }),
  // ì—¬ëŸ¬ ì¿¼ë¦¬ë¥¼ ë°°ì—´ë¡œ ë‚˜ì—´ ê°€ëŠ¥
]);
```

### Prisma íŠ¸ëœì­ì…˜ ì£¼ë¡œ ì“°ì´ëŠ” ê²½ìš°

- **ì—¬ëŸ¬ í…Œì´ë¸”ì„ í•œ ë²ˆì— ìˆ˜ì •í•´ì•¼ í•  ë•Œ**  
  ì˜ˆ) ì£¼ë¬¸í•  ë•Œ ì£¼ë¬¸ ë‚´ì—­ê³¼ ì¬ê³ ë¥¼ ë™ì‹œì— ì—…ë°ì´íŠ¸í•´ì•¼ í•˜ëŠ” ê²½ìš°

- **í•˜ë‚˜ì˜ ì‘ì—…ì— ì—¬ëŸ¬ ì¿¼ë¦¬ê°€ í•„ìš”í•œ ê²½ìš°**  
  ì˜ˆ) ê²Œì‹œê¸€ ì‘ì„±í•˜ë©´ì„œ ê´€ë ¨ íƒœê·¸ë“¤ë„ ê°™ì´ ì €ì¥í•´ì•¼ í•  ë•Œ

- **ì—¬ëŸ¬ ë°ì´í„°ë¥¼ ë™ì‹œì— ë°”ê¿”ì•¼ í•  ë•Œ (ë°ì´í„° ì •í•©ì„± ì¤‘ìš”)**  
  ì˜ˆ) ì¹¸ë°˜ ë³´ë“œì—ì„œ ì—¬ëŸ¬ ì‘ì—…(Task)ì˜ ìˆœì„œë¥¼ í•œêº¼ë²ˆì— ë°”ê¿€ ë•Œ

- **ë³µì¡í•œ ë¡œì§ìœ¼ë¡œ ì—¬ëŸ¬ ì¿¼ë¦¬ë¥¼ ì—°ì†í•´ì„œ ì‹¤í–‰í•´ì•¼ í•  ë•Œ**  
  ì˜ˆ) ì—¬ëŸ¬ ë‹¨ê³„ë¡œ ë‚˜ëˆ„ì–´ì§„ ì‘ì—…ì„ í•œ ë²ˆì— ì²˜ë¦¬í•  ë•Œ


---

## ğŸ¤” ì™œ Local ìƒíƒœì—ì„œëŠ” `fromColumn` / `fromIndex`ê°€ í•„ìš”í•˜ê³  APIì—ëŠ” í•„ìš” ì—†ì„ê¹Œ?

### Local(Zustand)ì—ì„œëŠ”

ë“œë˜ê·¸ ì•¤ ë“œë¡­ UIì—ì„œ ì¦‰ì‹œ ë°˜ì˜í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì—  
í™”ë©´ì— ë³´ì´ëŠ” ë°°ì—´ë§Œìœ¼ë¡œ ìœ„ì¹˜ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.  
ê·¸ë˜ì„œ ì‹œì‘ ìœ„ì¹˜(`fromColumn`, `fromIndex`)ì™€ ë„ì°© ìœ„ì¹˜(`toColumn`, `toIndex`)ë¥¼ ëª¨ë‘ ì•Œì•„ì•¼ í•©ë‹ˆë‹¤.

```ts
// zustand ì˜ˆì‹œ
moveTask: (fromColumn, toColumn, fromIndex, toIndex) =>
  set((state) => {
    const fromTasks = [...state.columns[fromColumn]];
    const taskToMove = fromTasks.splice(fromIndex, 1)[0];

    if (!taskToMove) return state;

    if (fromColumn === toColumn) {
      fromTasks.splice(toIndex, 0, taskToMove);
      return {
        columns: {
          ...state.columns,
          [fromColumn]: fromTasks,
        },
      };
    } else {
      const toTasks = [...state.columns[toColumn]];
      toTasks.splice(toIndex, 0, taskToMove);
      return {
        columns: {
          ...state.columns,
          [fromColumn]: fromTasks,
          [toColumn]: toTasks,
        },
      };
    }
  }),
```
### ì„œë²„(API)ì—ì„œëŠ”

`taskId`ë§Œ ìˆìœ¼ë©´ DBì—ì„œ í˜„ì¬ ìœ„ì¹˜ë¥¼ ì•Œ ìˆ˜ ìˆê¸° ë•Œë¬¸ì—  
`fromColumn`, `fromIndex`ë¥¼ êµ³ì´ ë°›ì„ í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.

ì„œë²„ ë™ì‘ ë°©ì‹ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

1. `taskId`ë¡œ í˜„ì¬ Taskë¥¼ ì¡°íšŒí•´ ì›ë˜ ì»¬ëŸ¼(status)ê³¼ ìˆœì„œë¥¼ í™•ì¸  
2. ìƒˆë¡œìš´ `toColumn`, `toIndex`ì— ë§ê²Œ ì¬ë°°ì¹˜  
3. íŠ¸ëœì­ì…˜ìœ¼ë¡œ DBì— ë°˜ì˜  

ì¦‰, APIëŠ” ë„ì°© ìœ„ì¹˜ë§Œ ì•Œë©´ ë˜ê³  ì‹œì‘ ìœ„ì¹˜ëŠ” DBì—ì„œ ì¶”ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.


## ğŸ“ë§ˆë¬´ë¦¬

- `/status` API â†’ `/move` APIë¡œ ë³€ê²½í•˜ë©° ê¸°ëŠ¥ í™•ì¥  
  ë‹¨ìˆœ status ë³€ê²½ì—ì„œ status + ìˆœì„œ(order) ì¬ì •ë ¬ë¡œ ê°œì„ í–ˆìŠµë‹ˆë‹¤.

- Prisma `$transaction`ì„ ì‚¬ìš©í•´ ì—¬ëŸ¬ update ì¿¼ë¦¬ë¥¼ ì›ìì ìœ¼ë¡œ ì²˜ë¦¬ì˜€ìŠµë‹ˆë‹¤.

- API ìš”ì²­ ë°ì´í„°ê°€ ë‹¨ìˆœí•´ì§: `taskId`, `toColumn`, `toIndex`ë§Œ ë°›ê³ , ì‹œì‘ ìœ„ì¹˜ëŠ” DBì—ì„œ ì¡°íšŒí•˜ì˜€ìŠµë‹ˆë‹¤.

- í´ë¼ì´ì–¸íŠ¸ ë¡œì»¬ ìƒíƒœì™€ ì„œë²„ ìƒíƒœì˜ ë™ê¸°í™” ë¬¸ì œ í•´ê²°í–ˆìŠµë‹ˆë‹¤.