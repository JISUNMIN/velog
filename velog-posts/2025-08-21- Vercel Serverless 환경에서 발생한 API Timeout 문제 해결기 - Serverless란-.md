Next.js í”„ë¡œì íŠ¸ì—ì„œ Task ê´€ë¦¬ APIë¥¼ êµ¬í˜„í•˜ë‹¤ê°€, ë¡œì»¬ í™˜ê²½ì—ì„œëŠ” ì˜ ë™ì‘í•˜ë˜ APIê°€ **Vercel Serverless** í™˜ê²½ì—ì„œëŠ” `504 Gateway Timeout` ì—ëŸ¬ê°€ ë°œìƒí•˜ëŠ” ë¬¸ì œë¥¼ ê²ªì—ˆìŠµë‹ˆë‹¤.  

---

## â— ë¬¸ì œ ìƒí™©
Kanban ë³´ë“œì—ì„œ **Task ìˆœì„œ ì´ë™**ì„ êµ¬í˜„í–ˆëŠ”ë°, API í˜¸ì¶œ ì‹œ ë‹¤ìŒê³¼ ê°™ì€ í˜„ìƒì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤.

- **ë¡œì»¬ í™˜ê²½ (localhost)** â†’ API ì‘ë‹µ ì†ë„: ì•½ 0.2ì´ˆ (ë§¤ìš° ë¹ ë¦„)  
- **Vercel Serverless í™˜ê²½** â†’ API ì‘ë‹µ ì†ë„: `504 Gateway Timeout` ë°œìƒ, ì¿¼ë¦¬ë¥¼ ê°œì„ í•´ë„ ì•½ 4ì´ˆ ì´ìƒ ì†Œìš”ë¨

```bash
PATCH /api/tasks/[taskId]/move
504 Gateway Timeout
```
ê¸°ì¡´ APIì—ì„œëŠ” **ìˆœì„œë¥¼ ë°±ì—”ë“œì—ì„œ ë‹¤ì‹œ ê³„ì‚°**í•˜ëŠ” ë¡œì§ì´ ìˆì—ˆìŠµë‹ˆë‹¤.
ì¦‰, ì´ë™í•  Taskë¥¼ ê¸°ì¤€ìœ¼ë¡œ DBì—ì„œ ê°™ì€ ì»¬ëŸ¼ì˜ Taskë“¤ì„ ëª¨ë‘ ë¶ˆëŸ¬ì™€ì„œ â†’ ìˆœì„œë¥¼ ì¬ê³„ì‚° â†’ ë³€ê²½ëœ Taskë“¤ì„ ì—…ë°ì´íŠ¸í•˜ëŠ” ë°©ì‹ì´ì—ˆìŠµë‹ˆë‹¤.


## ì„œë²„ë¦¬ìŠ¤ ê°œë… + ì½œë“œ ìŠ¤íƒ€íŠ¸ ì„¤ëª… (Context / Background)
# ğŸš€ ì„œë²„ë¦¬ìŠ¤(Serverless)ë€?

ì„œë²„ë¦¬ìŠ¤ëŠ” ì´ë¦„ë§Œ ë³´ë©´ "ì„œë²„ê°€ ì—†ë‹¤"ëŠ” ëœ» ê°™ì§€ë§Œ, ì‹¤ì œë¡œëŠ” **ê°œë°œìê°€ ì„œë²„ë¥¼ ì§ì ‘ ìš´ì˜í•˜ì§€ ì•Šì•„ë„ ë˜ëŠ” í™˜ê²½**ì„ ë§í•©ë‹ˆë‹¤.  
ëŒ€í‘œ ì„œë¹„ìŠ¤: **Vercel, AWS Lambda, Cloudflare Workers** ë“±

## íŠ¹ì§•

### 1. ìš”ì²­ ë‹¨ìœ„ ì‹¤í–‰
- ìš”ì²­ì´ ë“¤ì–´ì˜¬ ë•Œë§Œ ì„œë²„(ì‹¤ì œë¡œëŠ” í•¨ìˆ˜ ì‹¤í–‰ í™˜ê²½)ê°€ ì¼œì§
- ìš”ì²­ì´ ëë‚˜ë©´ ë°”ë¡œ êº¼ì§
- í•­ìƒ ì¼œì ¸ ìˆì§€ ì•Šê¸° ë•Œë¬¸ì— **ë¹„ìš©ì´ ì €ë ´í•˜ê³  ê´€ë¦¬ê°€ ì‰¬ì›€**

### 2. ìë™ í™•ì¥
- ìš”ì²­ì´ ë§ì•„ì§€ë©´ ìë™ìœ¼ë¡œ ì—¬ëŸ¬ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë„ì›Œì„œ ëŒ€ì‘
- ê°œë°œìëŠ” ì„œë²„ ê°œìˆ˜, ë¡œë“œë°¸ëŸ°ì‹± ë“±ì„ ì‹ ê²½ ì“¸ í•„ìš” ì—†ìŒ

### 3. ì œì•½ ì¡´ì¬
- **ì‹¤í–‰ ì‹œê°„ ì œí•œ**: ì˜ˆë¥¼ ë“¤ì–´ Vercel ë¬´ë£Œ í”Œëœì€ 10ì´ˆ ì œí•œ
- **DB ì»¤ë„¥ì…˜ ê´€ë¦¬ ì–´ë ¤ì›€**: ë§¤ ìš”ì²­ë§ˆë‹¤ ìƒˆë¡œ ì—°ê²°í•´ì•¼ í•˜ë¯€ë¡œ ëŠë ¤ì§ˆ ìˆ˜ ìˆìŒ

---

## â„ï¸ ì½œë“œ ìŠ¤íƒ€íŠ¸(Cold Start)ë€?
ì„œë²„ë¦¬ìŠ¤ í™˜ê²½ì—ì„œ ìì£¼ ë°œìƒí•˜ëŠ” ë¬¸ì œë¡œ, í•¨ìˆ˜ê°€ **ì²˜ìŒ ì‹¤í–‰ë  ë•Œ** ì‹¤í–‰ í™˜ê²½ì„ ìƒˆë¡œ ë„ìš°ëŠ” ê³¼ì •ì„ ë§í•©ë‹ˆë‹¤.  
(â†’ â€œì„œë²„ ì¼œê¸°â€ë¼ê³  ìƒê°í•˜ë©´ ì´í•´ ì‰¬ì›€)

### ì½œë“œ ìŠ¤íƒ€íŠ¸ ê³¼ì •
- ëŸ°íƒ€ì„(Node.js, Python ë“±) ì´ˆê¸°í™”
- ì˜ì¡´ì„± ë¡œë“œ (ì˜ˆ: Prisma, Axios)
- DB ì—°ê²° ì‹œë„  

ì´ ê³¼ì •ì—ì„œ ìˆ˜ë°± ms ~ ìˆ˜ ì´ˆê¹Œì§€ ì§€ì—°ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  

ë°˜ëŒ€ë¡œ, ì´ë¯¸ í•œ ë²ˆ ì‹¤í–‰ëœ í•¨ìˆ˜ê°€ ë©”ëª¨ë¦¬ì— ë‚¨ì•„ìˆìœ¼ë©´ **ì›œ ìŠ¤íƒ€íŠ¸(Warm Start)**ê°€ ë˜ì–´ í›¨ì”¬ ë¹ ë¥´ê²Œ ì‹¤í–‰ë©ë‹ˆë‹¤.

> ğŸ‘‰ Vercelì—ì„œ ì²˜ìŒ DBì— ì—°ê²°í•  ë•Œ ì˜¤ë˜ ê±¸ë¦¬ëŠ” ì´ìœ ê°€ ë°”ë¡œ ì´ **ì½œë“œ ìŠ¤íƒ€íŠ¸ + DB ì—°ê²° ì§€ì—°** ë•Œë¬¸ì…ë‹ˆë‹¤.

---

## ğŸ”‘ ìš”ì•½
- **ì„œë²„ë¦¬ìŠ¤(Serverless)**: ìš”ì²­ ë‹¨ìœ„ë¡œ ì‹¤í–‰ë˜ëŠ” ì„œë²„ í™˜ê²½  
  - ì¥ì : ê´€ë¦¬ê°€ ì‰¬ì›€, ìë™ í™•ì¥, ë¹„ìš© íš¨ìœ¨ì   
  - ë‹¨ì : ì‹¤í–‰ ì‹œê°„ ì œí•œ, ì½œë“œ ìŠ¤íƒ€íŠ¸, DB ì—°ê²° ë¬¸ì œ
- **ì½œë“œ ìŠ¤íƒ€íŠ¸(Cold Start)**: ì„œë²„ë¦¬ìŠ¤ í•¨ìˆ˜ê°€ ì²˜ìŒ ì‹¤í–‰ë  ë•Œ ëŸ°íƒ€ì„ê³¼ ì˜ì¡´ì„±, DB ì—°ê²°ì„ ìƒˆë¡œ ì¤€ë¹„í•˜ëŠ” ê³¼ì • â†’ ëŠë ¤ì§

> ğŸ‘‰ ì •ë¦¬í•˜ë©´,  
> ë¡œì»¬ì€ í•­ìƒ ì¼œì ¸ ìˆëŠ” ì„œë²„ë¼ DB ì—°ê²°ì„ ì¬ì‚¬ìš©í•˜ì§€ë§Œ,  
> Vercelì€ ë§¤ ìš”ì²­ë§ˆë‹¤ **â€œì„œë²„ ë¶€íŒ… â†’ DB ì—°ê²° â†’ ì¿¼ë¦¬ ì‹¤í–‰ â†’ ì¢…ë£Œâ€** ë¥¼ ë°˜ë³µí•˜ë¯€ë¡œ ëŠë¦½ë‹ˆë‹¤.



# ğŸ§© ë¬¸ì œ ì›ì¸ê³¼ í•´ê²° ê³¼ì • ì •ë¦¬

## ì›ì¸
ì´ ë¬¸ì œëŠ” **Vercel Serverless í•¨ìˆ˜ íŠ¹ì„±** ë•Œë¬¸ì— ë°œìƒí–ˆìŠµë‹ˆë‹¤.

### Serverless í•¨ìˆ˜ íŠ¹ì§• (Vercel ë¬´ë£Œ í”Œëœ ê¸°ì¤€)
- í•˜ë‚˜ì˜ API ìš”ì²­ë§ˆë‹¤ ì„œë²„ê°€ **ì½œë“œ ìŠ¤íƒ€íŠ¸(ì‹œì‘) â†’ DB ì—°ê²° â†’ ì¿¼ë¦¬ ì‹¤í–‰ â†’ ì¢…ë£Œ**
- ìš”ì²­ë‹¹ ì‹¤í–‰ ì‹œê°„ì´ **ìµœëŒ€ 10ì´ˆë¡œ ì œí•œ**
- ë³µì¡í•œ ì—°ì‚°(DB ì¡°íšŒ â†’ ì •ë ¬ â†’ ë‹¤ì¤‘ ì—…ë°ì´íŠ¸)ì„ í•˜ë©´ ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦¼

ğŸ‘‰ ë¡œì»¬ í™˜ê²½ì—ì„œëŠ” Prismaê°€ ì´ë¯¸ ì—°ê²°ëœ DB ì»¤ë„¥ì…˜ì„ **ì¬ì‚¬ìš©**í•˜ë¯€ë¡œ ë¹ ë¥´ê²Œ ë™ì‘í–ˆì§€ë§Œ,  
ğŸ‘‰ Serverless í™˜ê²½ì—ì„œëŠ” **ì¿¼ë¦¬ ì„±ëŠ¥ + í•¨ìˆ˜ ì‹¤í–‰ ì§€ì—°(ì½œë“œ ìŠ¤íƒ€íŠ¸)** ë•Œë¬¸ì— ì„±ëŠ¥ ì €í•˜ê°€ í¬ê²Œ ë°œìƒí–ˆìŠµë‹ˆë‹¤.

---

## âœ… í•´ê²° ë°©ë²•
í•µì‹¬ ì•„ì´ë””ì–´ëŠ” **ì„œë²„ í˜¸ì¶œ ìµœì†Œí™”** ì˜€ìŠµë‹ˆë‹¤.  
â†’ ìˆœì„œë¥¼ í”„ë¡ íŠ¸ì—ì„œ ê³„ì‚°í•˜ê³ , ì„œë²„ëŠ” update **í•œ ë²ˆë§Œ ìˆ˜í–‰**í•˜ë„ë¡ ë³€ê²½í–ˆìŠµë‹ˆë‹¤.

### ê¸°ì¡´ ë°©ì‹ (ë°±ì—”ë“œì—ì„œ order ê³„ì‚°)
```tsx
// handleDragEnd (ì´ì „ ì½”ë“œ)
const task = columns[sourceStatus][source.index];

moveTask(sourceStatus, destinationStatus, source.index, destination.index);

moveTaskMutate({
  id: task.id,
  toColumn: destinationStatus,
  toIndex: destination.index, // ì„œë²„ê°€ index ê¸°ì¤€ìœ¼ë¡œ order ê³„ì‚°
});

// app/api/tasks/[taskId]/move/route.ts (ì´ì „ ì„œë²„ ì½”ë“œ)
const tasks = await prisma.task.findMany({
  where: { status, projectId },
  orderBy: { order: "asc" },
  select: { id: true, order: true },
});

let newOrder: number;
if (tasks.length === 0) newOrder = 0;
else if (orderType === "top") newOrder = tasks[0].order! - 1;
else if (orderType === "bottom") newOrder = tasks[tasks.length - 1].order! + 1;
else if (index !== null) {
  const prevOrder = tasks[index - 1]?.order ?? 0;
  const nextOrder = tasks[index]?.order ?? prevOrder + 2;
  newOrder = prevOrder === nextOrder ? prevOrder + 0.0001 : (prevOrder + nextOrder) / 2;
} else newOrder = tasks[tasks.length - 1].order! + 1;

const newTask = await prisma.task.create({
  data: { title, desc, status, projectId, managerId, order: newOrder },
});

```
- ì„œë²„ì—ì„œ ì „ì²´ Task ë¶ˆëŸ¬ì˜´
- ìˆœì„œ ì¬ê³„ì‚° í›„ ë‹¤ì¤‘ update
- â± ì‘ë‹µ ì‹œê°„: local í™˜ê²½ì—ì„œëŠ” ë¬¸ì œ ì—†ì§€ë§Œ Vercel Serverless í™˜ê²½ì—ì„œ 4.83ì´ˆ 

### ë³€ê²½ ë°©ì‹ (í”„ë¡ íŠ¸ì—ì„œ order ê³„ì‚°)

```tsx
// handleDragEnd (ë³€ê²½ ì½”ë“œ)
const task = columns[sourceStatus][source.index];

// ì„ì‹œ ë°°ì—´ë¡œ ìƒˆë¡œìš´ ìˆœì„œ ê³„ì‚°
const tempTasks = [...columns[destinationStatus]];
if (sourceStatus === destinationStatus) tempTasks.splice(source.index, 1);
tempTasks.splice(destination.index, 0, task);

const prevOrder = tempTasks[destination.index - 1]?.order;
const nextOrder = tempTasks[destination.index + 1]?.order;

const newOrder =
  prevOrder == null && nextOrder == null ? 0 :
  prevOrder == null ? nextOrder! - 1 :
  nextOrder == null ? prevOrder + 1 :
  (prevOrder + nextOrder) / 2;

moveTask(sourceStatus, destinationStatus, source.index, destination.index, newOrder);

moveTaskMutate({
  id: task.id,
  projectId: Number(projectId),
  toColumn: destinationStatus,
  newOrder,
});


// app/api/tasks/[taskId]/move/route.ts (ë³€ê²½ ì„œë²„ ì½”ë“œ)
const { toColumn, order } = await req.json(); // í”„ë¡ íŠ¸ ê³„ì‚° order
await prisma.task.update({
  where: { id: Number(taskId) },
  data: { status: toColumn, order },
});
```
- í”„ë¡ íŠ¸ì—ì„œ prevOrder, nextOrder ê¸°ì¤€ìœ¼ë¡œ ìƒˆë¡œìš´ order ê³„ì‚°
- ì„œë²„ëŠ” update í•œ ë²ˆë§Œ ì‹¤í–‰
- â± ì‘ë‹µ ì‹œê°„: Vercel Serverless í™˜ê²½ì—ì„œ 1.19ì´ˆ

![](https://velog.velcdn.com/images/sunmins/post/8a31679d-13dc-417c-b45a-2b85030914ad/image.png)


## ğŸ¤” ì•ìœ¼ë¡œì˜ ê³ ë ¤ì‚¬í•­
Vercel Serverless **ë¬´ë£Œ í”Œëœì€ ê°„ë‹¨í•œ API ì¤‘ì‹¬**ìœ¼ë¡œ ì í•©í•©ë‹ˆë‹¤.  
ë³µì¡í•œ ì—°ì‚°ì´ í•„ìš”í•œ ê²½ìš°ì—ëŠ” ë‹¤ìŒì„ ê³ ë ¤í•´ì•¼ í•©ë‹ˆë‹¤:

- **ì „ìš© ì„œë²„ ì‚¬ìš©** (ì˜ˆ: AWS EC2, DigitalOcean Droplet)  
  â†’ í•˜ì§€ë§Œ ë‹¹ì¥ì€ ì „ìš© ì„œë²„ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³ , **ë¬´ë£Œ ì„œë²„ë¦¬ìŠ¤ì¸ Vercel í™˜ê²½ì—ì„œ ì•ˆì •ì ìœ¼ë¡œ ë™ì‘í•˜ë„ë¡ ì¿¼ë¦¬ì™€ ì„œë²„ í˜¸ì¶œì„ ìµœì†Œí™”**í•˜ëŠ” ë°©í–¥ìœ¼ë¡œ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.
---

## ğŸ“ ì •ë¦¬
- ë¡œì»¬ì—ì„œëŠ” ë¹ ë¥¸ APIê°€ **Vercel Serverless í™˜ê²½**ì—ì„œëŠ” Timeout ë°œìƒí•  ìˆ˜ ìˆìŒ  
- **ì›ì¸**: ì½œë“œ ìŠ¤íƒ€íŠ¸ + DB ë‹¤ì¤‘ ì¿¼ë¦¬ ì²˜ë¦¬  
- **í•´ê²° ë°©ë²•**: ì„œë²„ ë¡œì§ ë‹¨ìˆœí™” â†’ í”„ë¡ íŠ¸ì—ì„œ order ê³„ì‚° â†’ ì„œë²„ëŠ” update í•œ ë²ˆë§Œ ìˆ˜í–‰  
- **ìµœì í™” ê²°ê³¼**: ì‘ë‹µ ì‹œê°„ **4.83ì´ˆ â†’ 1.19ì´ˆ ê°œì„ **  
- **ë°°ìš´ ì **: Serverless í™˜ê²½ì—ì„œëŠ” **ë¬´ê±°ìš´ ì—°ì‚°ì„ í”¼í•˜ê³ , ìš”ì²­ íšŸìˆ˜ì™€ DB ì¿¼ë¦¬ë¥¼ ìµœì†Œí™”**í•´ì•¼ í•¨  
 
