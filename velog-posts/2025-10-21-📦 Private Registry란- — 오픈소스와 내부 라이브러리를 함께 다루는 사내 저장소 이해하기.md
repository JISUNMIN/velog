## 🧩 Private Registry의 정의

> “회사 내부망 안에서 운영되는 전용 npm 저장소”를 의미합니다.

[앞서 살펴본 것처럼,](https://velog.io/@sunmins/VPN%EC%9D%B4%EB%9E%80-%EA%B0%9C%EB%B0%9C%EC%9E%90%EB%8F%84-%EC%95%8C%EC%95%84%EC%95%BC-%ED%95%A0-%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC-%EA%B8%B0%EB%B3%B8-%EA%B0%9C%EB%85%90)  
VPN을 통해 내부망에 접속하면 회사에서 운영하는 **사내 npm Private Registry**에도 접근할 수 있습니다.  
그렇다면 이런 의문이 생깁니다. 🤔  
**“그럼 npm Private Registry는 회사에서 만든 사내 라이브러리만 설치할 수 있고, 기존 npmjs.org에 있는 오픈소스 라이브러리는 설치할 수 없는 걸까요?”**

이는 **Private Registry의 구성 방식**에 따라 다릅니다.  
어떤 구조로 구축되어 있느냐에 따라  
오픈소스 패키지를 함께 쓸 수도 있고, 완전히 차단될 수도 있습니다.

---

### 1️⃣ 프록시(Proxy) 형태의 Private Registry — ✅ 오픈소스도 함께 설치 가능

가장 일반적으로 사용되는 방식입니다.  
내부 npm 서버가 **공식 npm 서버(`https://registry.npmjs.org`)를 중계(프록시)** 하여,  
사내 라이브러리와 외부 오픈소스 패키지 둘 다 설치할 수 있습니다.

#### 🔧 작동 방식

1. 개발자가 `npm install react`를 실행하면  
   → 내부 레지스트리가 먼저 패키지를 검색  
2. 내부에 없으면  
   → 자동으로 **공식 npm 서버(npmjs.org)** 에서 받아옴  
3. 받아온 패키지를 **캐싱(Cache)** 하여, 다음에는 내부에서 바로 설치 가능  

#### 💡 장점

- 외부망을 직접 열지 않아도 **VPN 내부망만으로 모든 설치 가능**  
- 자주 쓰는 패키지는 캐시 덕분에 **설치 속도 향상**  
- **보안 + 편의성** 모두 확보 가능  

> ✅ 대부분의 기업 환경은 이 **프록시 캐시형 Private Registry**를 사용합니다.  
> 즉, VPN을 켜고 내부 서버를 바라보면  
> 사내 전용 라이브러리와 외부 오픈소스 모두 설치할 수 있습니다.

예시 도구:  
- **Verdaccio**, **Nexus**, **Artifactory**, **GitHub Packages**

---

### 2️⃣ 완전 폐쇄형 Private Registry — ❌ 오픈소스 설치 불가

보안이 매우 중요한 환경(금융기관, 공공기관 등)에서는  
**공식 npm 서버와 완전히 분리된 폐쇄형 Private Registry**를 사용하기도 합니다.

이 경우 내부 서버에는 **검증된 사내 및 오픈소스 패키지**만  
보안팀의 승인 후 **수동으로 업로드**되어 있습니다.

#### 💡 특징

- 외부 인터넷 접근이 완전히 차단됨  
- 오픈소스 패키지는 **보안 검증 후 반입 절차** 필요  
- 모든 설치는 **내부 저장소 한 곳에서만** 가능  

> ❗ 즉, 개발자가 `npm install`을 실행하더라도  
> 내부 서버에 등록된 패키지만 설치할 수 있고,  
> 새 오픈소스를 사용하려면 보안팀 승인이 선행되어야 합니다.

---

### 🧭 정리

| 구분 | 오픈소스 설치 가능 여부 | 특징 |
|------|----------------------|------|
| **프록시형 Private Registry** | ✅ 가능 (내부 서버가 외부 npmjs.org를 중계) | 일반 기업 환경에서 주로 사용 |
| **완전 폐쇄형 Private Registry** | ❌ 불가 (내부 저장소만 접근) | 금융/공공기관 등 보안 강화 환경 |

---

## 💡 실제 동작 예시 — VPN과 `.npmrc`를 이용한 Private Registry 연결

VPN과 npm 설정의 실제 연동 과정을 단계별로 살펴보면 다음과 같습니다.

### 1️⃣ VPN 연결

먼저 VPN을 실행하여 회사 내부망으로 진입합니다.  
이때 내부망의 서버 주소는 일반적으로 `172.x.x.x` 같은 **사설 IP 대역**입니다.

```bash
VPN 연결 완료 → 내부망 IP 172.20.10.x 대역 접근 가능
```
VPN이 연결되어야만 내부 npm 서버(http://172.20.10.5:4873) 같은 사내 주소에 접근할 수 있습니다.

---

### 2️⃣ `.npmrc`로 npm 레지스트리 주소 변경

이제 npm이 패키지를 어디서 받을지 지정해야 합니다.  
이를 **`.npmrc` 파일** 또는 **npm 설정 명령어**로 변경할 수 있습니다.

#### 📁 프로젝트 단위 설정

프로젝트 루트 경로에 `.npmrc` 파일을 생성하고 아래와 같이 작성합니다:

```bash
registry=http://172.20.10.5:4873
```

#### ⚙️ 전역 설정으로 적용하려면

```bash
npm config set registry http://172.20.10.5:4873
```


이제 npm은 공식 서버(`https://registry.npmjs.org`) 대신  
내부망에 위치한 `http://172.20.10.5:4873` **Private Registry**를 기본으로 사용하게 됩니다.

---

### 3️⃣ 설치 시 동작 흐름

이제 `npm install`을 실행하면 다음과 같이 동작합니다.
(아래의 `lodash`는 단순한 예시입니다. 어떤 패키지를 설치하더라도 흐름은 동일합니다.)

```bash
npm install lodash
```

VPN을 통해 **내부망(172.20.10.x)** 에 접속 중이므로  
→ **내부 Private Registry 서버**에서 `lodash` 패키지를 다운로드합니다.  

`.npmrc` 설정이 변경되었기 때문에  
→ **공식 npmjs.org**가 아닌 **내부 서버(Private Registry)** 로 요청이 전송됩니다.

### 💡 Private Registry 구성에 따른 동작 차이

| 구성 형태                    | 동작 방식                                                                               | 결과                          |
| ------------------------ | ----------------------------------------------------------------------------------- | --------------------------- |
| **프록시형 (Proxy + Cache)** | 내부 서버가 먼저 `lodash` 패키지를 검색하고,<br>없으면 **공식 npm 서버(npmjs.org)** 에서 받아와 내부에 저장(Cache). | ✅ 정상 설치 (내부 + 외부 패키지 모두 가능) |
| **완전 폐쇄형 (Isolated)**    | 내부 서버에서 `lodash`를 찾고,<br>없으면 외부망이 차단되어 **요청 실패(Error)** 발생.                         | ❌ 설치 실패 (내부에 등록된 패키지만 가능)   |


---

### ✅ 요약

| 단계 | 설명 |
|------|------|
| **1️⃣ VPN 연결** | 내부망 IP 대역(예: 172.x.x.x)에 진입 |
| **2️⃣ `.npmrc` 설정** | registry 주소를 내부 Private Registry로 변경 |
| **3️⃣ 패키지 설치** | VPN 터널을 통해 내부 서버에서 라이브러리 다운로드 |
| **4️⃣ 결과** | 내부 전용 라이브러리 + 오픈소스(프록시 캐시 시) 모두 이용 가능 |

---

> 💬 **정리하자면,**  
> - **VPN**은 내부망으로 들어가는 **보안 통로**,  
> - **`.npmrc`**는 npm이 패키지를 받을 **주소 설정 파일**,  
> - **Private Registry**는 내부망 안의 **패키지 저장소(창고)** 입니다.  
>
> 이 세 가지가 함께 동작해 외부망을 열지 않아도 내부망 환경에서 **안전하게 패키지를 설치하고 관리**할 수 있습니다. 

