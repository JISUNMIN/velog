## ⚠️ 문제 상황

Prisma를 사용해 프로젝트 관리 시스템을 개발하던 중, 프로젝트 삭제 API를 호출하면 다음과 같은 에러가 발생했습니다.

>Foreign key constraint violated on the constraint: Task_projectId_fkey


즉, 프로젝트에 연결된 `Task`들이 아직 DB에 남아 있어서, 프로젝트를 삭제할 수 없다는 뜻입니다.

## 🔍 원인

데이터베이스의 외래키 제약조건(Foreign Key Constraint) 때문에, 부모 테이블(`Project`)의 레코드를 삭제할 때 자식 테이블(`Task`)에 연관된 데이터가 남아 있으면 삭제가 불가능합니다.

데이터베이스는 프로젝트와 그 안의 작업들(태스크)이 서로 연결되어 있어서,
프로젝트를 삭제할 때 그 안에 남아있는 작업들이 있으면 삭제가 막힙니다.
이렇게 하면 데이터가 어긋나는 걸 막아주긴 하지만, 삭제가 안될 수 있습니다.
## 🛠️ 해결 방법 1: Prisma 스키마에 `onDelete: Cascade` 설정

`Task` 모델의 `project` 관계에 아래와 같이 `onDelete: Cascade` 옵션을 추가하면, 프로젝트가 삭제될 때 연관된 Task들이 자동으로 삭제됩니다.

> onDelete: Cascade는 데이터베이스에서 부모 테이블의 행(row)이 삭제될 때, 그와 연관된 자식 테이블의 행들도 자동으로 함께 삭제되도록 설정하는 옵션입니다.

```prisma
model Task {
  id         Int     @id @default(autoincrement())
  projectId  Int
  project    Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
  // 기타 필드...
}
```
이후 prisma migrate dev로 마이그레이션을 적용합니다.

``` 
npx prisma migrate dev --name add-delete-cascade
```


## ⚙️ 해결 방법 2: API에서 직접 자식 데이터 먼저 삭제

만약 스키마 변경이 어렵다면, 삭제 API에서 다음처럼 순서대로 삭제할 수 있습니다.

```ts
await prisma.task.deleteMany({
  where: { projectId: projectIdToDelete },
});

await prisma.project.delete({
  where: { id: projectIdToDelete },
});

```


## ✅ 요약 정리
Prisma를 활용할 때 외래키 제약조건 때문에 삭제가 안 되는 경우가 있는데,** onDelete: Cascade 옵션을 사용하거나 삭제 로직에서 자식 데이터를 먼저 삭제하는 방식을 적용 할 수 있습니다.**
이 방법을 통해 데이터 무결성을 유지하면서도 원하는 삭제 기능을 구현할 수 있습니다.