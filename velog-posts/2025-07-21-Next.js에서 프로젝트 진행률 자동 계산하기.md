í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ë©´ì„œ, ì „ì²´ ì‘ì—…(Task) ì¤‘ ì™„ë£Œ(Completed)ê°€ ëœ ì‘ì—…ì´ ëª‡ %ì¸ì§€ ë³´ì—¬ì£¼ëŠ” **ì§„í–‰ë¥ (progress)**ë¥¼ ê³„ì‚°í•´ì•¼ í•œë‹¤ëŠ” ì ì„ ê¹¨ë‹¬ì•˜ìŠµë‹ˆë‹¤.
ê·¸ëŸ°ë° ìƒê°í•´ë³´ë‹ˆ, Taskë¥¼ ìƒì„±í•˜ê±°ë‚˜ ì‚­ì œí•˜ê±°ë‚˜ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•  ë•Œë§ˆë‹¤ APIì—ì„œ Projectì˜ progressë¥¼ ê³„ì‚°í•´ì•¼ í•œë‹¤ëŠ” ê±¸ ì•Œê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

ê·¸ë˜ì„œ ì´ ë°˜ë³µë˜ëŠ” ì§„í–‰ë¥  ê³„ì‚° ë¡œì§ì„ ìœ í‹¸ í•¨ìˆ˜ë¡œ ë¶„ë¦¬í•˜ê³ , APIì˜ ì—¬ëŸ¬ ì—”ë“œí¬ì¸íŠ¸ì— ì ìš©í•´ë³´ì•˜ìŠµë‹ˆë‹¤.  

---
## ì§„í–‰ë¥  ê³„ì‚° í•¨ìˆ˜ ë§Œë“¤ê¸°

###  ğŸ“Š ê³„ì‚° ê³µì‹

```ts
progress = Math.floor((ì™„ë£Œëœ Task ìˆ˜ / ì „ì²´ Task ìˆ˜) * 100)
```

>Math.floor() ì •ì  ë©”ì„œë“œëŠ” ì–¸ì œë‚˜ ë²„ë¦¼ ì²˜ë¦¬í•˜ê³  ì£¼ì–´ì§„ ìˆ«ìì™€ ê°™ê±°ë‚˜ ì‘ì€ ì •ìˆ˜ ì¤‘ì—ì„œ ê°€ì¥ í° ìˆ˜ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.

- Task ì¤‘ ìƒíƒœê°€ "Completed"ì¸ ì‘ì—… ê°œìˆ˜ë¥¼ ì¹´ìš´íŠ¸í•˜ê³  ì „ì²´ Task ìˆ˜ ëŒ€ë¹„ ë¹„ìœ¨ì„ ê³„ì‚°í•´ 0~100 ì‚¬ì´ ì •ìˆ˜ ê°’ì„ ë§Œë“­ë‹ˆë‹¤.

###  utilsì— ì§„í–‰ë¥  ê³„ì‚° í•¨ìˆ˜ ë§Œë“¤ê¸°

```ts
// lib/utils/services/project/progress.ts
import { prisma } from "@/lib/prisma";

export async function updateProjectProgress(projectId: number) {
  const total = await prisma.task.count({ where: { projectId } });
  const completed = await prisma.task.count({
    where: {
      projectId,
      status: "Completed",
    },
  });

  const progress = total === 0 ? 0 : Math.floor((completed / total) * 100);

  await prisma.project.update({
    where: { id: projectId },
    data: { progress },
  });

  return progress;
}

```

- Taskê°€ 0ì¼ë•ŒëŠ” progressë¥¼ 0ìœ¼ë¡œ ì²˜ë¦¬ í–ˆìŠµë‹ˆë‹¤.
- "Completed" ìƒíƒœë§Œ ì™„ë£Œë¡œ ì·¨ê¸‰í•˜ë©°, í•˜ë“œì½”ë”©ë³´ë‹¤ëŠ” enumìœ¼ë¡œ ê´€ë¦¬í•˜ëŠ” ê²Œ ì•ˆì „í•©ë‹ˆë‹¤.


##  APIì—ì„œ í•¨ìˆ˜ í˜¸ì¶œí•˜ê¸°

Taskë¥¼ ë§Œë“¤ê±°ë‚˜, ìƒíƒœë¥¼ ë³€ê²½í•˜ê±°ë‚˜, ì‚­ì œí•˜ëŠ” API ë¡œì§ì—ì„œ ì´ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•´ Projectì˜ ì§„í–‰ë¥ ì„ ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸í•˜ë„ë¡ í–ˆìŠµë‹ˆë‹¤.

### âœ… Task ìƒì„± API ì˜ˆì‹œ
```ts
// app/api/tasks/route.ts
import { prisma } from "@/lib/prisma";
import { updateProjectProgress } from "@/lib/utils/services/project";
import { NextRequest, NextResponse } from "next/server";

export async function POST(req: NextRequest) {
  try {
    const body = await req.json();

    const newTask = await prisma.task.create({
      data: {
        title: body.title ?? "",
        desc: body.desc ?? "",
        status: body.status ?? "To Do",
        projectId: Number(body.projectId),
        managerId: Number(body.managerId),
      },
    });
    await updateProjectProgress(newTask.projectId);
    return NextResponse.json(newTask, { status: 201 });
  } catch (error) {
    console.error("Task ìƒì„± ì—ëŸ¬:", error);
    return NextResponse.json(
      { error: "Task ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤." },
      { status: 500 }
    );
  }
}
```

### ğŸ”„ Task ìƒíƒœ ë³€ê²½ API ì˜ˆì‹œ
```ts
// app/api/tasks/[taskId]/status/route.ts

import { prisma } from "@/lib/prisma";
import { updateProjectProgress } from "@/lib/utils/services/project";
import { NextRequest, NextResponse } from "next/server";

export async function PATCH(
  req: NextRequest,
  context: { params: Promise<{ taskId: string }> }
) {
  try {
    const { taskId } = await context.params;
    const { status } = await req.json();

    const updatedTask = await prisma.task.update({
      where: { id: Number(taskId) },
      data: { status },
    });
    await updateProjectProgress(updatedTask.projectId);
    return NextResponse.json(updatedTask, { status: 200 });
  } catch (error) {
    return NextResponse.json(
      { error: "Task ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨", detail: String(error) },
      { status: 500 }
    );
  }
}

```

### ğŸ—‘ï¸ Task ì‚­ì œ API ì˜ˆì‹œ
```ts
// /api/tasks/[taskId]  â†’ DELETE (task ì‚­ì œ)

import { prisma } from "@/lib/prisma";
import { updateProjectProgress } from "@/lib/utils/services/project";
import { NextRequest, NextResponse } from "next/server";

export async function DELETE(
  req: NextRequest,
  context: { params: Promise<{ taskId: string }> }
) {
  try {
    const { taskId } = await context.params;

    const newTask = await prisma.task.delete({
      where: { id: Number(taskId) },
    });
    await updateProjectProgress(newTask.projectId);
    return NextResponse.json(newTask, { status: 201 });
  } catch (error) {
    console.error("Task ì‚­ì œ ì—ëŸ¬:", error);
    return NextResponse.json(
      { error: "Task ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤." },
      { status: 500 }
    );
  }
}

```
## êµ¬í˜„ ê²°ê³¼

![](https://velog.velcdn.com/images/sunmins/post/cad07e91-80a8-4290-8ac2-9d491fe37ec7/image.png)


## ğŸ“ ë§ˆì¹˜ë©°

í”„ë¡œì íŠ¸ì˜ ì§„í–‰ë¥ (progress)ì€ "Completed" ìƒíƒœì˜ Task ìˆ˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ê³„ì‚°í•©ë‹ˆë‹¤.  
ì´ë¥¼ ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸í•˜ë ¤ë©´ Taskì˜ **ìƒì„±, ìˆ˜ì •, ì‚­ì œ, ìƒíƒœ ë³€ê²½** ì‹œë§ˆë‹¤ ì„œë²„ì—ì„œ ì¬ê³„ì‚°í•˜ëŠ” ë¡œì§ì´ í•„ìš”í•©ë‹ˆë‹¤.

ì´ ë¡œì§ì„ `updateProjectProgress(projectId)` ê°™ì€ **ìœ í‹¸ í•¨ìˆ˜ë¡œ ëª¨ë“ˆí™”**í•˜ë©´ ì¤‘ë³µì„ ì¤„ì´ê³  ìœ ì§€ë³´ìˆ˜ê°€ í›¨ì”¬ ì‰¬ì›Œì§‘ë‹ˆë‹¤.  
í”„ë¡ íŠ¸ì—”ë“œì—ì„œëŠ” ë³„ë„ë¡œ ê³„ì‚°í•  í•„ìš” ì—†ì´ í•­ìƒ ìµœì‹  ì§„í–‰ë¥  ì •ë³´ë¥¼ ë°›ì•„ì˜¬ ìˆ˜ ìˆì–´ êµ¬ì¡°ë„ ê¹”ë”í•´ì§‘ë‹ˆë‹¤.  
ìë™í™”ëœ ì§„í–‰ë¥  ê´€ë¦¬ëŠ” ì‚¬ìš©ì ê²½í—˜ì„ í–¥ìƒì‹œí‚¤ê³ , í”„ë¡œì íŠ¸ ìƒíƒœ íŒŒì•…ì„ í›¨ì”¬ ì§ê´€ì ìœ¼ë¡œ ë§Œë“¤ì–´ ì¤ë‹ˆë‹¤.