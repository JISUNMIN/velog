HTTP의 특징 중 하나는 **상태를 갖지 않는다는 점**입니다.  
이는 이전 요청과 응답에 대한 정보를 **서버에서 따로 저장하지 않는다**는 것을 의미합니다.

---

## 무상태 프로토콜 (Stateless Protocol)?

HTTP처럼 상태를 저장하지 않는 프로토콜이 있습니다.  
대표적으로 **IP**나 **UDP**가 무상태 프로토콜입니다.

>예시)  
클라이언트: 사이트 접속 (벌써 10번 들어옴)  
서버: 새 고객님이다!
클라이언트: 🤷?

### ✅ 장점
- 서버가 상태를 어떻게 저장할지 고려할 필요가 없기 때문에, 서버를 단순하게 설계 가능
- 갑작스럽게 통신이 끊어졌을 때 남겨진 상태를 어떻게 처리할지 고민하지 않아도 됨

### ❌ 단점
- 상태가 필요한 상황에서 요청마다 **추가 정보를 반복해서 전달**해야 함  
예: 로그인 후 장바구니에 물건을 담으려는데 다시 로그인하라고 하는 경우

---

## 상태 프로토콜 (Stateful Protocol)?

상태 정보를 저장하는 프로토콜로, 서버가 응답을 보낼 때 요청뿐 아니라 상태도 고려해야 합니다.  
대표적인 예로 **TCP**가 있으며, 신뢰성을 보장하기 위해 각 패킷의 전송 상태를 파악하는 일이 중요합니다.

>예시)   
클라이언트: 사이트 접속 (벌써 10번 들어옴)  
서버: 단골 고객님이네!

---

## ❓ 그런데 쇼핑몰에서는 왜 로그인 후 장바구니 사용이 가능할까?

> 그 이유는 **프로토콜 외부에서 상태를 관리**하기 때문입니다.

서버 외부에 저장소를 두고 그곳에서 상태를 저장한 후,  
필요한 정보를 서버로 전달하여 **HTTP가 가진 단점(무상태성)**을 보완하는 방식입니다.

---

## 상태 정보를 저장하는 방법들

### 1. 쿠키 (Cookie)

브라우저에 데이터를 저장하는 대표적인 방식입니다.

- 예시: "오늘 하루 보지 않기"
- 이유: DB에 저장하면 사용자 수가 늘어남에 따라 관리해야 할 데이터가 많아짐 → 브라우저에 저장

#### 특징
- 키/값 형태의 문자열만 저장 가능
- 최대 4KB
- [F12 → Application → Storage → Cookies]에서 확인 가능
- 두 종류:  
  - 세션 쿠키 (Session Cookie): 브라우저 종료 시 삭제됨  
  - 영구 쿠키 (Persistent Cookie): 만료 기간까지 유지됨

#### 사용 방식
1. 서버가 응답 시 쿠키 정보를 함께 전송
2. 클라이언트는 쿠키를 브라우저에 저장
3. 이후 모든 요청에 쿠키를 함께 보냄

#### 보안 관련
- 보안에 취약 (예: 비밀번호가 암호화 없이 저장될 수 있음)
- 따라서 로그인 정보보다는 팝업 숨기기, 다크모드 등 **개인 설정**에 주로 사용됨

---

### 2. 웹 스토리지 (Web Storage)

HTML5부터 등장한 기능으로, 키/값 형태로 문자열을 저장합니다.

#### 장점
- 쿠키는 4KB 제한, 웹 스토리지는 **5MB~10MB 저장 가능**
- **서버로 자동 전송되지 않음** → 네트워크 통신량 절감
- 클라이언트에서만 접근 가능 → 서버가 별도 접근 불가

#### 구분
- **로컬 스토리지 (Local Storage)**  
  브라우저에 저장되며, 삭제하지 않는 한 **계속 유지**
- **세션 스토리지 (Session Storage)**  
  브라우저 탭이나 창을 닫으면 **즉시 삭제**

[F12 → Application → Storage → LocalStorage / SessionStorage]에서 확인 가능

#### 사용 예시 (로컬 스토리지 기준)
```js
// 데이터 추가
localStorage.setItem('키', '값');

// 데이터 가져오기
localStorage.getItem('키');

// 데이터 제거
localStorage.removeItem('키');

// 전체 데이터 제거
localStorage.clear();
```


### 3. IndexedDB
브라우저에 내장된 데이터베이스로, 웹스토리지보다 훨씬 강력하게 데이터 저장 가능합니다.

#### 특징
- 문자열뿐 아니라 다양한 데이터 타입 저장 가능
- 대용량 데이터도 체계적으로 관리 가능
- 용량 제한이 없음
- 데이터 조회에 최적화됨
- 다만 쿠키나 웹스토리지보다 설정과 사용이 복잡함


### 4. 세션 (Session)

- 서버 측에서 일시적으로 데이터를 저장하는 방식입니다.
- 원래는 클라이언트와 서버가 연결된 상태나 시간을 의미하지만,  
  보통 사용자 정보를 서버에서 관리하는 방식도 "세션"이라고 부릅니다.
- 세션은 서버에 데이터를 저장하고, 클라이언트는 세션 ID만 쿠키 형태로 저장합니다.
- 쿠키와 반대되는 개념처럼 보일 수 있으나, 실제로는 **쿠키 기반**으로 동작합니다.

#### ✅ 구조
- 클라이언트: 세션 ID를 쿠키로 저장  
- 서버: 세션 ID에 대응하는 사용자 상태 정보를 별도로 저장

#### ✅ 주로 사용되는 곳
- 로그인 상태 유지  
- 사용자 인증 및 권한 관리  
- 장바구니 정보 저장  
- 사용자별 임시 설정 (예: 최근 본 상품, 필터 상태 등)


#### 🔄 세션과 쿠키 관계 요약

1. 👇 클라이언트가 서버에 처음 요청  
   → 서버는 사용자를 식별할 수 있는 **세션 ID**를 생성  
   → 이 **세션 ID를 쿠키**로 만들어 클라이언트에게 응답

2. 클라이언트는 이 쿠키(세션 ID)를 브라우저에 저장

3. 다음 요청부터는  
   → 브라우저가 자동으로 세션 ID 쿠키를 서버로 전송  
   → 서버는 세션 ID를 보고 해당 사용자의 정보를 서버 쪽 세션 저장소에서 꺼냄

---

### ❓ 그래서 정확히 말하면?

- **서버가 세션 ID만 쿠키에 담아** 클라이언트에 전달합니다.

- 사용자 정보(로그인 상태, 장바구니 등)는  
  서버 메모리나 DB 같은 저장소에 따로 저장되고,  
- 클라이언트는 세션 ID만 들고 다니며  
  🪪 "** 나 이 사람이야**"라고 인증하는 역할을 합니다.
  
  ---


## ✅ 요약 정리

| 저장소 종류                       | 저장 위치                   | 저장 용량        | 데이터 유형          | 서버 전송 여부   | 유지 기간                                  | 사용 빈도                         | 대표 활용 분야                | 보안 수준                                  |
| ---------------------------- | ----------------------- | ------------ | --------------- | ---------- | -------------------------------------- | ------------------------------ | --------------------------- | -------------------------------------- |
| **쿠키 (Cookie)**              | 클라이언트 브라우저 (HTTP 헤더 포함) | 약 4KB        | 문자열 (키/값)       | 요청 시 자동 전송 | 세션 쿠키: 브라우저 종료 시 삭제<br>영구 쿠키: 만료일까지 유지, 브라우저 종료와 상관 없음 | 🌟 매우 높음                        | 로그인 인증, 세션 관리, 간단한 사용자 설정 등 | ★★★☆☆ (Secure, HttpOnly, SameSite 옵션 적용 시 보안 강화 가능) |
| **로컬 스토리지 (LocalStorage)**   | 클라이언트 브라우저              | 5MB~10MB 이상 | 문자열 (키/값)       | 전송하지 않음    | 영구적 (사용자가 삭제 전까지 유지)                   | 🌟 매우 높음                        | 사용자 설정 저장, 앱 상태 보존, 캐싱 등에 많이 사용 | ★★☆☆☆ (XSS 공격에 취약)                 |
| **세션 스토리지 (SessionStorage)** | 클라이언트 브라우저              | 5MB~10MB 이상 | 문자열 (키/값)       | 전송하지 않음    | 탭/창 종료 시 삭제                            | 중간                            | 탭 단위 임시 저장 (로그인 상태 등 단기 데이터)     | ★★☆☆☆ (XSS 공격에 취약)                 |
| **IndexedDB**                | 클라이언트 브라우저              | 무제한에 가까움     | 다양한 데이터 타입 지원   | 전송하지 않음    | 영구적 (사용자가 삭제 전까지 유지)                   | 보통 이하 (특정 앱에서 주로 사용) | 복잡한 데이터 저장, 오프라인 지원, PWA 등       | ★★☆☆☆ (XSS 공격에 취약)                 |
| **서버 세션 (Session)**          | 서버 메모리/DB               | 서버 자원 한도 내   | 다양한 (객체, 문자열 등) | 해당 없음      | 클라이언트 쿠키 세션 ID와 연동, 서버에서 관리            | 🌟 매우 높음                        | 로그인/인증, 장바구니, 사용자별 상태 저장         | ★★★★★ (서버 관리 + 쿠키 옵션 적용)           |



> ❓ PWA는 ‘진보된 웹 앱’으로, 네이티브 앱처럼 빠르고 오프라인에서도 동작하는 웹 앱입니다.
IndexedDB는 PWA에서 데이터를 로컬에 저장하고, 네트워크 없이도 앱이 원활하게 동작하도록 하는 핵심 기술 중 하나입니다.




---

##  👨‍💻 로그인 인증 흐름 이해하기: 서버 세션, 쿠키, 로컬스토리지 역할

### 1. 사용자가 로그인 폼에 아이디/비밀번호 입력 후 로그인 버튼 클릭

### 2. 서버에서 로그인 인증 후 동작

| 저장 위치        | 역할 및 처리 내용                                             | 설명                                  |
|----------------|-----------------------------------------------------------|-------------------------------------|
| **서버 세션**      | 서버가 로그인한 사용자 정보를 메모리/DB에 저장                      | 로그인 상태, 권한, 장바구니 등 중요 데이터 관리 |
| **쿠키**          | 서버가 응답 헤더에 `Set-Cookie: sessionId=abcdef; HttpOnly; Secure;` 발송 | 클라이언트는 이 쿠키를 브라우저에 저장하고, 이후 요청에 자동으로 보냄 |
| **로컬스토리지**   | 클라이언트가 `localStorage.setItem('theme', 'dark')` 같은 개인 설정 저장 | 로그인과 직접 관련 없고, UI 맞춤 설정 같은 개인화 정보 저장 |

---

### 3. 로그인 후 사용자가 페이지 이동, 새로고침 할 때

- **쿠키**: 브라우저가 자동으로 `sessionId` 쿠키를 서버에 보냄  
- **서버 세션**: 서버가 쿠키의 세션 ID로 해당 사용자 세션 조회 → 로그인 상태 유지, 권한 확인  
- **로컬스토리지**: UI 맞춤 설정 불러오기, 로그인 유지와 직접 무관  

---

### 4. 로그아웃 시

- 서버 세션 삭제 (서버 메모리/DB에서 세션 제거)  
- 쿠키 만료 날짜를 과거로 설정해 삭제  
- 로컬스토리지 개인 설정은 유지되거나 삭제 (개발자가 결정)  

---

### 간단 흐름표  

| 단계               | 서버 세션                      | 쿠키                             | 로컬스토리지                      |
|------------------|---------------------------|-------------------------------|------------------------------|
| 로그인 성공           | 사용자 정보 저장                  | 세션 ID 쿠키 발급                    | 개인화 설정 저장 (선택적)             |
| 요청 보낼 때          | 세션 ID로 사용자 확인              | 요청 시 자동으로 세션 ID 전송           | 서버로 전송하지 않음                   |
| 로그인 유지 상태 확인    | 세션 데이터로 로그인 여부 판단       | 서버에 자동 전송되어 세션 확인에 도움       | 클라이언트 UI 용도                    |
| 로그아웃            | 세션 삭제                      | 쿠키 삭제                         | 설정 삭제 여부는 선택적                 |

---

## 정리

- **서버 세션**: 로그인 상태 및 중요한 데이터 저장 → 보안적이고 서버에서 관리  
- **쿠키**: 서버 세션 ID를 저장하여 클라이언트와 서버 사이 연결 고리 역할 → 매 요청마다 서버로 전송  
- **로컬스토리지**: 로그인과 직접 관계 없고, UI 개인 설정 저장 → 서버 전송 안 함, 보안에 취약  

---





