### 🤔 Supabase 테이블 생성 후 데이터 관리 관련 고민과 Prisma 사용 이유

Supabase에서 테이블을 직접 생성하고 데이터를 직접 `insert`하는 경우,  
터미널에서 `prisma db pull` 명령어를 실행하면 Prisma 스키마와 실제 DB 상태 간에 차이가 발생할 수 있습니다.

이로 인해 Prisma가 히스토리 불일치를 감지하고,  
종종 ⚠️`reset`(재설정)을 하라는 안내 메시지가 나오기도 합니다

### ❗문제점

- Supabase 콘솔과 Prisma 스키마 간 동기화가 어려움  
- 직접 Supabase에서 데이터를 수정하면 Prisma 마이그레이션 기록과 충돌 가능성 있음  
- Prisma를 통한 마이그레이션 관리가 불완전해질 위험  
- `reset` 명령어를 실행하면 데이터가 삭제되어 다시 세팅해야 하는 번거로움과 🔄중복 작업 발생

###  ✅ 그래서 이렇게 하려고 합니다

- 데이터베이스 구조와 데이터도 **Prisma를 통해 등록, 삭제, 수정**하도록 관리  
- Prisma 마이그레이션과 시딩 스크립트를 활용해 DB 상태를 일관되게 유지  
- 이를 통해 Supabase와 Prisma 간 스키마 및 데이터 동기화 문제를 최소화  

이렇게 하면 개발 환경에서 데이터와 스키마를 Prisma가 전담 관리하므로,  
예측 가능하고 안정적인 DB 상태를 유지할 수 있습니다.

---
# Prisma Seed Script 작성 및 실행 실습

## 1. script 폴더에 seed.ts 파일 생성

![스크립트 생성](https://velog.velcdn.com/images/sunmins/post/47705008-59ff-4d39-b189-ca94f2632bd9/image.png)

### 왜 파일명을 seed라고 할까요?

- 데이터베이스 초기 데이터를 넣는 작업을 **시딩(seeding)**이라고 부릅니다.
- `seed.ts`나 `seed.js` 파일은 프로젝트 시작 시 데이터베이스에 기본 데이터(사용자, 샘플 데이터 등)를 넣기 위한 스크립트 파일 이름의 관례입니다.

---

## 2. prisma.[모델명].create 형식으로 데이터 생성 코드 작성

```ts
// seed.ts
import { prisma } from "../lib/prisma.js";

async function main() {
  // User 생성
  const user1 = await prisma.user.create({
    data: {
      userId: "user01",
      password: "password123",
      name: "홍길동",
    },
  });

  // Project 생성 (managerId는 user1.id로 연결)
  const project1 = await prisma.project.create({
    data: {
      projectId: "project01",
      progress: 0,
      deadline: new Date("2025-12-31"),
      managerId: user1.id,
    },
  });

  // Task 생성 (userId와 managerId는 user1.id, projectId 연결)
  const task1 = await prisma.task.create({
    data: {
      title: "첫 번째 작업",
      desc: "테스트용 작업 설명",
      status: "To Do",
      projectId: project1.id,
      userId: user1.id,
      managerId: user1.id,
    },
  });

  // Comment 생성 (userId, taskId 연결)
  await prisma.comment.create({
    data: {
      comment: "첫 번째 댓글입니다.",
      userId: user1.id,
      taskId: task1.id,
    },
  });

  console.log("초기 데이터가 성공적으로 추가되었습니다.");
}

main()
  .catch((e) => {
    console.error(e);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
  });
```


## 3. [ts-node](https://velog.io/@sunmins/ts-node%EB%9E%80)를 이용해 seed 스크립트 실행

> node --loader ts-node/esm ./src/scripts/seed.ts

![](https://velog.velcdn.com/images/sunmins/post/280c1243-713d-4a54-a624-0b3326b38949/image.png)

### JavaScript 파일 실행 방법

- **JS 파일인 경우** `ts-node` 없이 아래 명령어로 실행할 수 있습니다.

```bash
node ./src/scripts/seed.js
```

## 4. npx prisma studio 명령어로 데이터베이스 데이터 확인
![](https://velog.velcdn.com/images/sunmins/post/1b1787cf-2cc6-4e1f-b810-02282c9da754/image.png)

## ✅ 요약 정리
### 1. 초기 데이터(시드 데이터)는 Seed Script로 미리 넣기

- 기본 설정, 관리자 계정, 테스트용 샘플 데이터 등을 초기화할 때 사용  
- 개발/테스트 환경을 빠르게 준비하고 팀원 간 환경 통일 가능  
- DB 상태를 예측 가능하게 만들어 오류 가능성 감소

#### 여러 데이터 한 번에 넣기: `createMany` 사용 예시

```ts
await prisma.user.createMany({
  data: [
    { userId: "user01", password: "pass01", name: "홍길동" },
    { userId: "user02", password: "pass02", name: "김철수" },
    { userId: "user03", password: "pass03", name: "이영희" },
  ],
  skipDuplicates: true, // 중복된 데이터는 무시
});
```
createMany를 사용하면 여러 데이터를 한 번에 효율적으로 삽입 가능

skipDuplicates 옵션으로 중복 데이터 삽입 방지 가능

### 2. 그 이후 데이터는 API를 통해 생성/수정하기

- 운영 데이터는 API를 통해 CRUD 작업 수행  
- 직접 DB에 넣는 것보다 데이터 무결성, 권한 관리, 트랜잭션 처리에 유리  
- 비즈니스 로직과 유효성 검사, 권한 체크 적용 가능

### 정리

| 구분          | 방법               | 이유                              |
| ------------- | ------------------ | -------------------------------- |
| 초기 필수 데이터 | Seed Script        | 환경 초기화, 기본값 세팅           |
| 운영 데이터     | API / 어플리케이션 | 권한 관리, 유효성 검사, 안정적 운영 |



## 마치며
Prisma 마이그레이션과 시딩 스크립트를 활용하면
데이터와 스키마를 일관되게 관리할 수 있어,
Supabase와의 동기화 문제를 줄이고 안정적인 개발 환경을 만들 수 있습니다.

⚠️ 직접 DB를 수정하는 대신 Prisma를 통해 관리하는 것이 좋습니다.
